// Generated by CoffeeScript 1.9.3
(function() {
  var compile2SassAndJade, exec, fs, hassDir, iconv, jadeDir, path, publicDir, readFile, sassDir, writeFile;

  exec = require('child_process');

  path = require('path');

  fs = require('fs');

  iconv = require('iconv-lite');

  publicDir = path.join(__dirname, '..', '');

  hassDir = path.join(publicDir, 'demo/hass', 'index.hass');

  sassDir = path.join(publicDir, 'demo/sass', 'index.sass');

  jadeDir = path.join(publicDir, 'demo/jade', 'index.jade');

  readFile = function(hass_file, sass_file, jade_file) {
    console.log(1 + sass_file);
    return fs.readFile(hass_file, function(err, data) {
      var str;
      if (err) {
        return console.log('2 读取文件fail' + err);
      } else {
        str = iconv.decode(data, 'utf-8');
        console.log(str);
        return writeFile(sass_file, str);
      }
    });
  };

  writeFile = function(file, str) {
    var arr;
    arr = iconv.encode(str, 'utf-8');
    console.log('3' + arr);
    return fs.appendFile(file, arr, function(err) {
      if (err) {
        return console.log('4 写入文件fail' + err);
      } else {
        return console.log('4 写入文件ok');
      }
    });
  };

  compile2SassAndJade = function(hass_file, sass_file, jade_file) {
    return readFile(hass_file, sass_file, jade_file);
  };

  console.log('1 compile' + hassDir + ' once...');

  compile2SassAndJade(hassDir, sassDir, jadeDir);


  /*
  console.log 'watching file ...'
  
  fs.watchFile(hassDir, {
          persistent: true,
          interval: 1000
      },
      (curr, prev) ->
          console.log('the file changed, compile ...')
          compile2SassAndJade(hassDir, sassDir, jadeDir)
      );
   */

}).call(this);
